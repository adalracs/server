<?php
	$Modulos = array( 'n</div>',
			 '<td >Estado de la tramitaci',
			 "n Planta Interna Linea</div>",
			 "n Planta Externa Linea</div>",
		//	 "</tr>    </tbody></table>",
			 "Datos ADSL Destino</div>",
			 "n de los PC</div></td>",
			 "Productos y Servicios</div>",
			 "Quiebres[Historico]");

	$password = array( 'valign=',
			'style=','class=',
			'id=','type=','value=',
			'name=','&nbsp;','align=',
			'href=','onclick=','src=',
			'border=','height=','width=',
			'colspan=','"right"','"#"',
			'"javascript:ocultar(document.getElementById(tableCabecera),document.getElementById(filaCabecera1),document.getElementById(filaCabecera2));"',
			'"DespliegaPantallaC12o_files/mas.gif"',
			'"0"','"15"','"encabezados-tabla"',
			'"filaCabecera2"','"6"','"left"','"DespliegaPantallaC12o_files/menos.gif"',
			'"contenido"','"tableCabecera"','"fila-detalle-impar"',
			'"top"','"text-align: right;"','"hayIDPC"','"hidden"','"fila-detalle-par"',
			'"center"','"ODSPeticion"','"109064"','"listado"','"display: none;"','"filaEstado1"',
			
			'"javascript:ocultar(document.getElementById(tableEstado),document.getElementById(filaEstado1),document.getElementById(filaEstado2));"',
			'"filaEstado2"','"tableEstado"','"filaPtaVieja1"',
			
			'"javascript:ocultar(document.getElementById(tablePtaVieja),document.getElementById(filaPtaVieja1),document.getElementById(filaPtaVieja2));"',
			'"filaPtaVieja2"','"tablePtaVieja"','"nroTelAsig"','"23963868"','"filaPtaExterna1"',
			'"javascript:ocultar(document.getElementById(tablePtaExterna),document.getElementById(filaPtaExterna1),document.getElementById(filaPtaExterna2));"',
			'"filaPtaExterna2"','"tablePtaExterna"','"10"','"1"','"4"','<script>','</script>','function','refrescarDatosTecnicos',
			'()','{','}','"filaNodo1_1"',
			'"javascript:ocultar(document.getElementById(tablePtaVieja),document.getElementById(filaPtaVieja1),document.getElementById(filaPtaVieja2));"',
			'"filaPtaVieja2"','"tablePtaVieja"','"23963868"','"nroTelAsig"','"filaPtaExterna1"',
			'"javascript:ocultar(document.getElementById(tablePtaVieja),document.getElementById(filaPtaVieja1),document.getElementById(filaPtaVieja2));"',
			'"filaPtaVieja2"','"tablePtaVieja"','"23963868"','"nroTelAsig"','"filaPtaExterna1"',
			'"javascript:ocultar(document.getElementById(tableNodo1),document.getElementById(filaNodo1_1),document.getElementById(filaNodo2_1));"',
			'"filaNodo2_1"','"tableNodo1"','<!--','"5"','"3"','-->','"filaPC1"',
			'"javascript:ocultar(document.getElementById(tablePC),document.getElementById(filaPC1),document.getElementById(filaPC2));"',
			'"filaPC2"','"tablePC"','"elementos-filtro"','"filaPS1"',
			'"javascript:ocultar(document.getElementById(tablePS),document.getElementById(filaPS1),document.getElementById(filaPS2));"',
			'"filaPS2"','"vieneDe"','"null"','"template"','"Flujo_AT_VPI_STB_BA"','"instanciaActividad"',
			'"RUEAAAABB4coRwAAAAAAAAAAAAAAGAAAAAEAWsAHAAAAAAAAAAAAAAAYQQAAAAEHjeBEAAAAAAAAAABF"','"codigoActividad"','"Director de Flujos.Instalacion.Instalar"',
			'"instanciaProceso"','"195411"','"folio"','"tabs"','"tab0"','"activo"','"javascript:tab(0)"','"tab1"','""','"javascript:tab(1)"','"tablePS"',
			'"text-align:right"','"/vpistbbaweb/img/menos.gif"','"/vpistbbaweb/img/mas.gif"','"display:none"','"text-align: right"'); 

			$Camp_Moduno = array ( 'n:</td>	    <td>','</td>',
				    'Identificador PC Linea:</td>         <td>','<input',
				    'Identificador PC TV:</td>		<td>','</td>',
				    'Nombre:</td>		<td>','</td>',
				    'n:</td>		<td>','</td>',
				    'Tipo Documento:</td>    <td>','</td>',
				    'Tipo Uso:</td>    <td>','</td>',
				    'Nombre Interlocutor:</td>    <td>','</td>',
				    'Telefono Contacto Interlocutor:</td>    <td>','</td>',
				    'Tipo Documento Interlocutor:</td>    <td>','</td>',
				    'n interlocutor:</td>    <td>','</td>',
				    'fono de contacto:</td>    <td>','</td>',
				    'Canal Venta:</td>    <td>','</td>',
				    'Fecha de registro:</td>    <td>','</td>',
				    'Fecha de compromiso:</td>    <td>','</td>',
				    'Departamento:</td>    <td>','</td>',
				    'n:</td>    <td>','</td>',
				    'Localidad:</td>    <td>','</td>',
				    'n:</td>    <td>','</td>',
				    'n:</td>    <td>','</td>',
				    'Barrio:</td>    <td>','</td>',
				    'Segmento:</td>    <td>','</td>',
				    'n:</td>    <td>','</td>',
				    'SubSegmento:</td>    <td>','</td>',
				    'n:</td>    <td>','</td>',
				    'ODS:</td>    <td>','</td>',
				    'Cantidad Troncales:</td>    <td>','</td>',
				    'n:</td>    <td>','<input' );
				    
				    
			$Camp_Moddos = array( 'Estado:</td>    <td>','</td>',
				    'n:</td>    <td>','</td>',
				    'Fecha Ultima Actividad:</td>    <td>','</td>' );
			
			$Camp_Modtres =array( 'Central:</td>	<td>','</td>',
					'fono:</td>	<td>','<input',
					'Len:</td>	<td>','</td>',
					'Horizontal:</td>	<td>','</td>' );

			$Camp_Modcua = array( 'Distribuidor:</td>		<td>','</td>',
					'n:</td>		<td>','</td>',
					'Distribuidor:</td>		<td>','</td>',
					'n:</td>		<td>','</td>',
					'n:</td>		<td >','</td>',
					'Cable:</td>		<td>','</td>',
					'Par Cable:</td>		<td>','</td>',
					'Armario:</td>		<td>','</td>',
					'del Armario:</td>		<td>','</td>',
					'digo Caja:</td>		<td>','</td>',
					'Par Caja:</td>		<td>','</td>',
					'n Caja:</td>		<td>','</td>',
					'Dslam:</td>	</tr>	<tr  >		<td  >','</td>' );
					
			$Camp_Modcin = array( 'Puerto:</td>	    	<td>','</td>',
					'POTs:</td>	   	    <td>','</td>',
					'Adsl:</td>	    	<td>','</td>',
					'n IP dslam:</td>	   	    <td>','</td>',
					'n IP wan:</td>	    	<td>','</td>',
					'n IP lan:</td>	    	<td>','</td>',
					'Mascara lan:</td>	    	<td>','</td>',
					'Frame:</td>	    	<td>','</td>',
					'Tarjeta:</td>	   	    <td>','</td>',
					'VPI/VCI Cliente:</td>	   	    <td>','</td>',
					'VPI/VCI Red:</td>	   	    <td>','</td>',
					'mero de Pcs:</td>	   	    <td>','</td>',
					'mero de Tarjetas:</td>	   	    <td>','</td>',
					'meros de USB:</td>	    	<td>','</td>',
					'Sistema Operativo:</td>	   	    <td>','</td>',
					'Disco Duro:</td>	   	    <td>','</td>',
					'Ram:</td>	   	    <td>','</td>',
					'Usuario Acceso:</td>	    	<td>','</td>' );
			
			$Camp_Modsei = array( '<tbody><tr  >		<td ><div >','</div>',
					'PS</div></td>	    <td>','</td>',
					'Tipo PC / SubTipo PC</div></td>	    <td>','</td>',
					'n</div></td>	    <td >','</td>',
					'Departamento</div></td>	    <td>','</td>',
					'Localidad / Sub Localidad</div></td>	    <td>','</td>',
					'Fecha de Compromiso</div></td>	    <td>','</td>',
					'<td ><div >','</div></td>',
					'PS</div></td>	    <td>','</td>',
					'Tipo PC / SubTipo PC</div></td>	    <td>','</td>',
					'n</div></td>	    <td >','</td>',
					'Departamento</div></td>	    <td>','</td>',
					'Localidad / Sub Localidad</div></td>	    <td>','</td>',
					'Fecha de Compromiso</div></td>	    <td>','</td>' );
			
			$Camp_Modsie = array( '</tr>	<tr  >  	    <td><div >',
					'<td><div >',
					'<td>			<div >');
					
			$Replace = array( '<div','<DIV',
							'<img','<IMG',
							'<td','<TD',
							'<tr','<TR',
							'<table','<TABLE',
							'<tbody','<TBODY',
							'<input','<INPUT',
							'<li','<LI',
							'<ul','<LU',
							'<a','<A',
							'</div>','</DIV>',
							'</img>','</IMG>',
							'</td>','</TD>',
							'</tr>','</TR>',
							'</table>','</TABLE>',
							'</tbody>','</TBODY>',
							'</input>','</INPUT>',
							'</li>','</LI>',
							'</ul>','</UL>',
							'</a>','</A>');

	
	$filepath = "../doc/ot_cargados/tmp".$numtemp.".html";
	
	$FileServ = fopen( $filepath, "r" );
	$buffer = fread( $FileServ, filesize( $filepath ) );
	
	$buffer = str_replace("'","",$buffer);

	for( $j = 0;$j < count( $password ); $j++ ){
		$buffer = str_replace($password[$j],"", $buffer);
	}
	

	
	$finData = 0;
	$xpos = 0;
	
	for( $i = 1; $i < count($Modulos); $i++ ){
		if(strpos( $buffer, trim( $Modulos[$xpos] ), $finData ) != false){
			$iniData = strpos( $buffer, trim( $Modulos[$xpos] ), $finData ) + strlen( trim( $Modulos[$xpos] ) );
			
			if (strpos( $buffer, trim( $Modulos[$i] ), $iniData ) != false){
				$finData = strpos( $buffer, trim( $Modulos[$i] ), $iniData );

				$Mod_dataorden[$xpos] = str_replace("\r\n","",substr( $buffer, $iniData, $finData - $iniData )); //Linea windows	
				//$Mod_dataorden[$xpos] = str_replace("\n","",substr( $buffer, $iniData, $finData - $iniData ));	 //Linea Linux	
			
				for($j = 0 ; $j++,$j < count($Replace); $j++ ){
					$Mod_dataorden[$xpos] = str_replace($Replace[$j],$Replace[$j-1],$Mod_dataorden[$xpos]);
				}
				
	/*			
				$new_file = fopen("../doc/ot_cargados/hc.adsumdat","a");
				//fwrite($new_file,":I:[".str_replace("\n","",$Mod_dataorden[$xpos])."]:F: \n"); // Linea Linux
				fwrite($new_file,":I:[".str_replace("\r\n","",$Mod_dataorden[$xpos])."]:F: \n"); // Linea Windows
				fclose($new_file);
*/
				
				
				$xpos = $i;		
			}
		}else{
			$xpos = $i;
		}		
	}


	//$new_file = fopen("../doc/ot_cargados/@tiempo.adsumdat","a");

	$finData = 0;
	if($Mod_dataorden[0]){
		for( $i = 0; $i++, $i < count($Camp_Moduno); $i++ ){
			$iniData = strpos( $Mod_dataorden[0], trim( $Camp_Moduno[$i - 1] ), $finData ) + strlen( trim( $Camp_Moduno[$i - 1] ) );
			$finData = strpos( $Mod_dataorden[0], trim( $Camp_Moduno[$i] ), $iniData );
			
			$cont_array ++;
			$New_camp[$cont_array] = trim(substr( $Mod_dataorden[0], $iniData, $finData - $iniData ));
			//fwrite($new_file,":I:[".$New_camp[$cont_array]."]:F: \n");
		}
	}
	
	$finData = 0;
	if($Mod_dataorden[1]){
		for( $i = 0; $i++, $i < count($Camp_Moddos); $i++ ){
			$iniData = strpos( $Mod_dataorden[1], trim( $Camp_Moddos[$i - 1] ), $finData ) + strlen( trim( $Camp_Moddos[$i - 1] ) );
			$finData = strpos( $Mod_dataorden[1], trim( $Camp_Moddos[$i] ), $iniData );

			$cont_array ++;
			$New_camp[$cont_array] = trim(substr( $Mod_dataorden[1], $iniData, $finData - $iniData ));
			//fwrite($new_file,":I:[".$New_camp[$cont_array]."]:F: \n");
		}
	}
	
	$finData = 0;
	if($Mod_dataorden[2]){
		for( $i = 0; $i++, $i < count($Camp_Modtres); $i++ ){
			$iniData = strpos( $Mod_dataorden[2], trim( $Camp_Modtres[$i - 1] ), $finData ) + strlen( trim( $Camp_Modtres[$i - 1] ) );
			$finData = strpos( $Mod_dataorden[2], trim( $Camp_Modtres[$i] ), $iniData );
				
			$cont_array ++;
			$New_camp[$cont_array] = trim(substr( $Mod_dataorden[2], $iniData, $finData - $iniData ));
			//fwrite($new_file,":I:[".$New_camp[$cont_array]."]:F: \n");
		}
	}	
	
	$finData = 0;
	if($Mod_dataorden[3]){
		for( $i = 0; $i++, $i < count($Camp_Modcua); $i++ ){
			$iniData = strpos( $Mod_dataorden[3], trim( $Camp_Modcua[$i - 1] ), $finData ) + strlen( trim( $Camp_Modcua[$i - 1] ) );
			$finData = strpos( $Mod_dataorden[3], trim( $Camp_Modcua[$i] ), $iniData );
				
			$cont_array ++;
			$New_camp[$cont_array] = trim(substr( $Mod_dataorden[3], $iniData, $finData - $iniData ));

			if($i == 25){
			
				if($New_camp[$cont_array] == 'No hay dslam disponibles' ){	
					//fwrite($new_file,":I:[".$New_camp[$cont_array]."]:F: \n");
					break;
				}else{
					$finData = 0;
					for(;;){	
						if(strpos( $Mod_dataorden[3], trim( ')Ip:</td>		<td  >' ), $finData ) != false){
							$iniData = strpos( $Mod_dataorden[3], trim( ')Ip:</td>		<td  >' ), $finData ) + strlen( trim( ')Ip:</td>		<td  >' ) );
							$finData = strpos( $Mod_dataorden[3], trim( '</td>' ), $iniData );

							$cont_array ++;
							$New_camp[$cont_array] = trim(substr( $Mod_dataorden[3], $iniData, $finData - $iniData ));
							//fwrite($new_file,":I:[".$New_camp[$cont_array]."]:F: \n");
						
							$iniData = strpos( $Mod_dataorden[3], trim( 'Tipo:</td>		<td  >' ), $finData ) + strlen( trim( 'Tipo:</td>		<td  >' ) );
							$finData = strpos( $Mod_dataorden[3], trim( '</td>' ), $iniData );

							$cont_array ++;
							$New_camp[$cont_array] = trim(substr( $Mod_dataorden[3], $iniData, $finData - $iniData ));
							//fwrite($new_file,":I:[".$New_camp[$cont_array]."]:F: \n");
						}else{
							break;
						}
					}
					break;
				}
			}
			//fwrite($new_file,":I:[".$New_camp[$cont_array]."]:F: \n");
		}
	}
	
	$finData = 0;
	if($Mod_dataorden[4]){
		for( $i = 0; $i++, $i < count($Camp_Modcin); $i++ ){
			$iniData = strpos( $Mod_dataorden[4], trim( $Camp_Modcin[$i - 1] ), $finData ) + strlen( trim( $Camp_Modcin[$i - 1] ) );
			$finData = strpos( $Mod_dataorden[4], trim( $Camp_Modcin[$i] ), $iniData );
	
			$cont_array ++;			
			$New_camp[$cont_array] = trim(substr( $Mod_dataorden[4], $iniData, $finData - $iniData ));
			//fwrite($new_file,":I:[".$New_camp[$cont_array]."]:F: \n");
		}
	}
	
	$finData = 0;
	if($Mod_dataorden[5]){
		for( $i = 0; $i++, $i < count($Camp_Modsei); $i++ ){
			if(strpos( $Mod_dataorden[5], trim($Camp_Modsei[$i - 1] ), $finData ) != false){
				$iniData = strpos( $Mod_dataorden[5], trim( $Camp_Modsei[$i - 1] ), $finData ) + strlen( trim( $Camp_Modsei[$i - 1] ) );
				$finData = strpos( $Mod_dataorden[5], trim( $Camp_Modsei[$i] ), $iniData );

				$cont_array ++;				
				$New_camp[$cont_array] = trim(substr( $Mod_dataorden[5], $iniData, $finData - $iniData ));
				//fwrite($new_file,":I:[".$New_camp[$cont_array]."]:F: \n");
			}
		}
	}	
	$finData = 0;	
	if($Mod_dataorden[6]){
		if(strpos( $Mod_dataorden[6], trim($Camp_Modsie[0] ), $finData ) != false){
			$iniData = strpos( $Mod_dataorden[6], trim( $Camp_Modsie[0] ), $finData ) + strlen( trim( $Camp_Modsie[0] ) );
			$finData = strpos( $Mod_dataorden[6], trim( '</div>'), $iniData );

			$cont_array ++;
			$New_camp[$cont_array] = trim(substr( $Mod_dataorden[6], $iniData, $finData - $iniData ));
			//fwrite($new_file,":I:[".$New_camp[$cont_array]."]:F: \n");		
			$conntar = 1;
			for( $i = 0;  $i < 80; $i++ ){
				$conntar ++;
				if($conntar <= 5){
					if(strpos( $Mod_dataorden[6], trim($Camp_Modsie[1] ), $finData ) != false){
						$iniData = strpos( $Mod_dataorden[6], trim( $Camp_Modsie[1] ), $finData ) + strlen( trim( $Camp_Modsie[1] ) );
						$finData = strpos( $Mod_dataorden[6], trim( '</div>'), $iniData );
						$cont_array ++;
						$New_camp[$cont_array] = trim(substr( $Mod_dataorden[6], $iniData, $finData - $iniData ));
					}else{					
						break;
					}
				}else{
					$conntar=0;
					$iniData = strpos( $Mod_dataorden[6], trim( $Camp_Modsie[2] ), $finData ) + strlen( trim( $Camp_Modsie[2] ) );
					$finData = strpos( $Mod_dataorden[6], trim( '</div>'), $iniData );

					$cont_array ++;
					if(trim(substr( $Mod_dataorden[6], $iniData, $finData - $iniData )) != "")
						$New_camp[$cont_array] = "imagen check";
					else 
						$New_camp[$cont_array] = "";
				}
				//fwrite($new_file,":I:[".$New_camp[$cont_array]."]:F: \n");
			}
		}
	}
	
/*	for($i = 1; $i <= $cont_array; $i++){
		fwrite($new_file,$i.":I:[".$New_camp[$i]."]:F: \n");	
	}
	fclose($new_file);
	unlink("../doc/ot_cargados/tmp".$numtemp.".html");
	
	/*$Solicitud = explode("-",$New_camp[0]);
	for($i = 0 ; $i < count($Solicitud) ; $i++){
		$clientsolici = $clientsolici
	}*/
	
	
	
	$idcnx = fncconn();
	$result = loadrecordclienteot($New_camp[1],$idcnx);
	if ($result > 0){
		$flagexistreg = 1;
	}
		


	unlink("../doc/ot_cargados/tmp".$numtemp.".html");
	
	
	$fecha1 = explode(" ",trim($New_camp[14]));
	$fecha2 = explode(" ",trim($New_camp[15]));
	
	$fechmed1 = explode("/",$fecha1[0]);
	$fechmed2 = explode("/",$fecha2[0]);
	
	$iregClienteot[clientsolici] =$New_camp[1];
	$iregClienteot[clientfecsol] = $fechmed1[2]."-".$fechmed1[1]."-".$fechmed1[0];
	$iregClienteot[clientfecco] = $fechmed2[2]."-".$fechmed2[1]."-".$fechmed2[0];
	$iregClienteot[clientnombre] = $New_camp[4];
	$iregClienteot[clientdirecc] = $New_camp[20];
	$iregClienteot[clienttelefo] = $New_camp[12];
	$iregClienteot[clientcontac] = $New_camp[8];
	$iregClienteot[clienttelcon] = $New_camp[9];
	$iregClienteot[clienthorsol] = $fecha1[1];
	$iregClienteot[clienthorco] = $fecha2[1];
	
	
	
	$iregClienteot[deptocodigo] = $New_camp[16];
	$iregClienteot[ciudadcodigo] = trim(substr($New_camp[18],0,strlen($New_camp[18]) - 3));
	$mincFilePlan = "@tiempo.adsumdat";
	
?>